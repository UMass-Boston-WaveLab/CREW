% !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

% This is a simple template for a LaTeX document using the "article" class.
% See "book", "report", "letter" for other types of document.

\documentclass{allertonproc} 

%%% Examples of Article customizations
% These packages are optional, depending whether you want the features they provide.
% See the LaTeX Companion or other references for full information.
\usepackage{cite}
\usepackage{graphicx} % support the \includegraphics command and options
\usepackage{amsmath}
% \usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent

%%% PACKAGES
\usepackage{booktabs} % for much better looking tables
\usepackage{array} % for better arrays (eg matrices) in maths
\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim
\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float
% These packages are all incorporated in the memoir class to one degree or another...

%%% The "real" document content comes below...

\title{SPATIAL CHANNEL PREDICTION FOR EAVESDROPPING ON WIRELESS FADING BASED KEY GENERATION} %this title is not bad
\author{Eric Brown, Clara Gamboa, and K.~C.~Kerby-Patel\\University of Massachusetts Boston, Boston, MA\\kc.kerby-patel@umb.edu} %the convention is that the advisor's name goes last
%also have to put in our UMB affiliation blurb
\date{} % Activate to display a given date or no date (if empty),
         % otherwise the current date is printed 

\begin{document}
\maketitle
\bibliographystyle{ieeetran}

\begin{abstract}

Physical layer key generation techniques based on wireless channel fading are generally considered to be secure as long as any eavesdroppers are separated from the terminals by a distance greater than the channel correlation length.  This assertion depends on an assumption that the channel is ergodic, while many real-world channels are not ergodic.  Since a non-ergodic channel's transfer function is determined by the physical scatterers in that particular channel realization, linear prediction has previously been employed to predict samples of the channel transfer function ahead in time.  In this work, we demonstrate that it is also possible to predict the channel transfer function in space, over distances larger than the correlation length.  This leads us to conclude that a more pessimistic ``safe'' eavesdropper distance for wireless fading based key generation is needed.
\end{abstract}
%we will have to compute the correlation length from the observed channel covariance matrix.  

%\textbf{Key words:} -- wireless, channel, fading, key generation, physical layer, security

\section{Introduction}
%belongs to Clara
To be able to connect two parties in an encrypted channel without relying on predetermined keys is crucial for safe communication, but require a common source of random information that is unique to communicating parties. It has been demonstrated \cite{azimisadjadi2007, bloch2008, mathur2008, ye2010} that two parties' reciprocal observations of wireless channel fading can be used as a common source of randomness to generate symmetric encryption keys quickly in cases where two parties cannot pre-arrange keys.  
%this sentence is weird
Meaning that if you have a known waveform to measure a channel, the transmitting party can send the receiving party an encoded message that uses as a decryption key the reciprocity of the signals and the superposition of many corresponding scattered which will destructively or constructively, depending on location, and interfere with the known waveform.
%end weird sentence

Recently proposed fading-based encryption methods \cite{some of them} assume that 
%Previously it was assumed that
 for an eavesdropper $E$ farther than a correlation length of the channel away from source channel, between $A$ and $B$, that $E$ could know almost nothing about the reciprocity key. 
 %reword preceding sentence to remove notation by talking about an eavesdropper at least a correlation length away from both of the communicating nodes.
 This assumption stemming from the idea that the channel model between A and B's location are random. %fix grammar, cite Jakes, depends on channel being Gaussian (because correlation function is proportional to mutual information for Gaussian random variables)
 While it is often useful to use Gaussian random variables to generate a model channel for simulation purposes, channels in the real world depend deterministically on the physical environment, even if the environmental parameters are unknown.
%Meaning that the correlation length depends on an ensemble average of the channel correlation function. Other wise stated, $E$ could calculate the parameters of the channel between $A$ and $B$ because the wireless channel is not ergodic vs. time \cite{isukapalli2006} which can than be shown to not be ergodic vs. position as well. 
If the channel is ergodic, it is reasonable to assume that two observations of the channel separated in time or space are jointly Gaussian random variables, and the correlation length is an acceptable estimate for the minimum secure distance.
However, it has been shown that real-world wireless channels are typically not ergodic vs. time \cite{isukapalli2006}.  In this work, we show that the spatial average of such a channel's correlation function is not equal to the ensemble average, meaning that the channel is also not ergodic vs. space.  This indicates that security claims based on the correlation length are inappropriate.  To develop a more practical estimate of the minimum distance from a node to an eavesdropper, we apply channel prediction techniques \cite{duel-hallen2007} to investigate the distance over which it is possible to predict the channel transfer function.


Instead of describing the setup here, describe the topics that will be discussed in the rest of the paper.
%In this case the observation points of the eavesdropper are placed in far-field of both transmitter and scatterers;, with stationary observation points; all observation occur at the same moment in time; and are predicted at the same instant in time. The far-field assumption allows us to say that the channel observations from those points are not specially ergodic, and having the channel be non-ergodic lets us know that that channel transfer function varies in an known but deterministic way.  This can be said since we don't see a change in the channel realization within the collection of observation points. Allowing $E$, a passive listener to obtain meaningful information about the channel key. 


Section \ref{ergodicity} applies the method of \cite{isukapalli2006} to show that the spatial average of a channel's correlation function is not generally equal to the ensemble average, indicating that the channel is not spatially ergodic. Next, in Section \ref{prediction}, we apply long-range prediction techniques to a series of spatial samples in order to predict the channel transfer function over distances greater than the correlation length.  In Section \ref{simresults}, we apply this technique to a simple simulated channel to examine the dependence of prediction length on the properties of the channel and the eavesdropper array. %these are: number of scatterers; eavesdropper element spacing; and number of eavesdropper elements.


\section{Spatial Ergodicity}\label{ergodicity}
Past work on key generation from wireless fading has often stated that the key thus generated can be considered secure as long as all eavesdroppers are separated by at least half a carrier wavelength from both of the communicating nodes \cite{azimisadjadi2007, bloch2008, mathur2008, ye2010}.  This is based on the fact that the channel correlation function drops off quickly as a function of distance \cite{jakes1974}.  However, low correlation does not necessarily indicate low mutual information.  The correlation function is proportional to the mutual information if the two observations are jointly Gaussian \cite{li1990}; however, this is only the case if the channel is ergodic.  It has been shown by Isukapalli et al. \cite{isukapalli2006} that a typical wireless channel is not ergodic in the temporal sense (that is, the time average of the correlation function is not necessarily equal to its ensemble average).  In this section, we will follow the derivation from \cite{isukapalli2006} to show that typical wireless channels are also not spatially ergodic (that is, the spatial average of the correlation function is not necessarily equal to its ensemble average), as long as the total sampled length is sufficiently short.

%added Doppler spatial phase variation to the channel model!!  f = fc+fd because f=(1+v/c)fc.  but k = 2pi/lambda, lambda = c/f, k = 2pi fc(1+v/c)/c.  so it's ok to write k as kc+kd, where kd = 2pi fd/c.
Begin by assuming that the channel is represented by a sum-of-sinusoids model as shown in Equation \ref{chan}.  The parameters $\alpha_n$, $\omega_d\cos\theta_n$, $k_d\cos\theta_n$, and $\vec{r_n}$ describe the amplitude, Doppler frequency shift, Doppler wavenumber, and location of the $n$th scatterer, and $\vec{r}$ represents the observation point.
\begin{equation}\label{chan}
h(\vec{r},t)= \sum_{n=1}^N \alpha_n e^{j \omega_d t \cos \theta_n} e^{-j(k+k_d\cos\theta_n)\left|\vec{r_n} - \vec{r}\right|}
\end{equation}
An observation of the channel impulse response at a new location, $\vec{r}+\vec{\Delta r}$, can be written as shown in Equation \ref{chanloc2} if $|\vec{\Delta r}|$ is small enough that all scatterers are in the far field of the pair of observation points.
\begin{equation}\label{chanloc2}
h(\vec{r}+\vec{\Delta r},t) = \sum_{n=1}^N \alpha_n e^{j \omega_d t \cos \theta_n} e^{-j(k+k_d\cos\theta_n)\left|\vec{r_n}-\vec{r}\right|}e^{-jk\left|\vec{\Delta r}\right| \cos \psi_n}
\end{equation}

The correlation function (based on the ensemble average) for two spatially separated but simultaneous observations can be separated into a single sum of squared terms from the same scatterer (the first term in Equation \ref{ensemblecorr}) and a double sum of contributions from two different scatterers (the second term).
\begin{multline}\label{ensemblecorr}
R_e(\vec{\Delta r})= E\left[\sum_{n=m=1}^N |\alpha_n|^2 e^{-j(k+k_d\cos\theta_n)|\vec{\Delta r}|\cos \psi_n}\right] +\\ E\left[\sum_{n=1}^N\sum_{m\neq n} \alpha_n^* \alpha_m e^{j \omega_d (\cos \theta_m - \cos \theta_n)} e^{-j(k+k_d\cos\theta_n)\left(\left|\vec{r_m} - \vec{r}\right|-\left|\vec{r_n} - \vec{r}\right|\right)}e^{-jk\left|\vec{\Delta r}\right| \cos \psi_m}\right]
\end{multline}
The second expected value term in Equation \ref{ensemblecorr} is eliminated by the integration of the complex exponential containing $\left|\vec{r_m} - \vec{r}\right|-\left|\vec{r_n} - \vec{r}\right|$ during calculation of the expected value.  

To simplify further, we assume that $E[|\alpha|^2]=1/N$.  Now the correlation function depends on the distributions of $\theta$ and $\psi$:
\begin{equation}\label{generalcorr}
R_e(\vec{\Delta r})=\iint_{-\pi, -\pi}^{\pi,\pi}e^{-j k |\vec{\Delta r}| \cos(u)} e^{-j k_d |\vec{\Delta r}| \cos (v) \cos(u)} p_{\theta}(v) p_{\psi}(u) du dv
\end{equation}

Equation \ref{generalcorr} is simplified as much as is possible without making any assumptions about the probability distributions of $\theta$ and $\psi$.  However, if $\theta$ is uniformly distributed, this can be simplified to 
\begin{equation}
R_e(\vec{\Delta r})=\int_{-\pi}^{\pi}e^{-j k |\vec{\Delta r}| \cos(u)} J_0(k_d |\vec{\Delta r}| \cos(u))p_{\psi}(u) du 
\end{equation}
%the math departs from Isukapalli here because of the addition of the Doppler wavenumber. 

If $\psi$ is uniformly distributed, we can use the identity in Equation \ref{identity} \cite{gradshteyn2007} and a plane wave expansion to evaluate the integral with respect to $u$, arriving at Equation \ref{finalcorr}.
\begin{equation}\label{identity}
\int_0^{\pi} J_0(2z\cos(x))cox(2nx)dx = (-1)^n \pi J_n^2(z)
\end{equation}
% Gradshteyn, I. and Ryzhik, I., Table of Integrals, Series, and Products, 7th edition, Academic Press: Amsterdam, 2007 page 724
\begin{equation}\label{finalcorr}
R_e(\vec{\Delta_r}) = J_0^2(\frac{k_d |\vec{\Delta_r}|}{2})J_0(k|\vec{\Delta_r}|) + 2\sum_{n=1}^{\infty}(-1)^n J_n(k|\vec{\Delta_r}|)J_{n/2}^2(\frac{k_d |\vec{\Delta_r}|}{2})
\end{equation}

On the other hand, the spatial average of $h(\vec{r}+\vec{\Delta_r},t)h^*(\vec{r},t)$ is given by
\begin{multline}
R_r\left(\vec{\Delta r}\right) =  \lim_{D \rightarrow \infty} \frac{3}{4\pi D^3}\int_0^D\int_{-\pi}^\pi \int_{-\pi}^{\pi} \sum_{n=m=1}^N |\alpha_n|^2 e^{-j(k+k_d\cos\theta_n)|\vec{\Delta r}|\cos \psi_n}+\\ \sum_{n=1}^N\sum_{m\neq n} \alpha_n^* \alpha_m e^{j \omega_d t(\cos \theta_m - \cos \theta_n)} e^{-j(k+k_d\cos\theta_n)\left(\left|\vec{r_m} - \vec{r}\right|-\left|\vec{r_n} - \vec{r}\right|\right)}e^{-jk\left|\vec{\Delta r}\right| \cos \psi_m}r^2 \sin\theta dr d\theta d\phi
\end{multline}
Again the second term is eliminated by the integration of the complex exponential containing $\left|\vec{r_m} - \vec{r}\right|-\left|\vec{r_n} - \vec{r}\right|$.  What remains in the integrand does not depend on position, so the spatial average correlation is given by 
\begin{equation}\label{spatialcorr}
R_r\left(\vec{\Delta r}\right) =  \sum_{n=1}^N |\alpha_n|^2 e^{-j(k+k_d\cos\theta_n)|\vec{\Delta r}|\cos \psi_n}
\end{equation}

Depending on the number of scatterers $N$ and their angular distribution, Equation \ref{spatialcorr} may approach Equation \ref{finalcorr} \cite{isukapalli2006}.  However, real-world channels typically do not have sufficient scatterers to achieve this condition \cite{duel-hallen2000}.  

Spatial non-ergodicity physically means that all spatial samples observe the same channel realization.  The scatterer angles and amplitudes do not change appreciably within the collection of viewpoints.  In this case, successive spatial samples do have some mutual information, and a series of spatial samples can be used to predict the channel transfer function ahead spatially, using methods which have already been demonstrated for temporal long-range prediction \cite{duel-hallen2000}.
%this section might need some graphs in it, demonstrating how the correlation function and the spatial sample covariance are different for different situations - that might make it too long, though, and I want to focus on the other bits.

\section{Spatial Long-Range Channel Prediction Method}\label{prediction}
%belongs to Eric
As discussed in Section 3, the channel's spatial variation is not ergodic, therefore it is well suited to long-range prediction techniques \cite{(someone, perhaps a duel-hallen paper, said this)}. Rather than using long-range prediction to predict the channel transfer function ahead temporally, we predict it spatially. 

Previous literature(CITE) has shown that this problem is conducive to a spectral estimation approach. This is due tot he fact that we are only attempting to predict a small number of wavelengths forward in space. (DUEL-HALLEN PAPER) States that channel can be very accurately estimated within a signle doppler wavelength, which encompasses several carrier wavelengths. In temporal prediction applications, it has been observed that time variation of the amplitudes and frequencies in the sum-of-sinusoids model is on the order of 0.1 seconds \cite{duel-hallen2007} \emph{This may depend on how fast they assume the receiver is moving?} (WHY Do we need this?).  In order to assemble an acceptable set of data to solve a spectral estimation problem, we simulate array of spatial samples with regular spacing to collect information on the wireless channel.

We simulate the listener as a series of recievers along a line that points in the direction of the point we'd like to simulate. Since we assume that all sampling occurs simultaneously our equation is simplified. The Equation \ref{chan} describes a transfer function along a line.


\begin{equation}\label{chan}
\hat{H}= \sum_{n=1}^N \alpha_n e^{-j(k+k_d\cos\theta_n)d}
\end{equation}

 Where $\hat{H}$ is the channel estimate, $\alpha_n$ is the $n^{th}$ complex amplitude, N is the number of samples, $d$ is the distance between the samples, k is the wave number, and $k_d\cos\theta_n$ is the doppler wave number. 

Our unknowns in this system are the amplitude and the wave numbers. We make the assumption that the angle of arrival for all the listening samples is the same because they are all in the far field. This array of samples is of length $Nd+qd$, where $q$ is the number of sample lengths ahead we'd like to predict. With this channel prediction model we obtain a set of data points for the channel in each location, then use spectral estimation to project this sample out to the location of B.

The solution to the estimation problem can be broken into two parts. Estimating the amplitudes, then estimation the wave number $k$ from the resultant amplitude array. We used the rootMUSIC algorithm supplied in MATLAB to determine the amplitudes. RootMUSIC uses eigenvalue analysis of the channel's correlation matrix to estimate the signals frequency content. The specific command used estimates the discrete frequency spectrum, and provides the signal power.  In order to determine wavenumber we used the method described in (CITE paper cant find it)(Describe method we used, took a covariance matrix did stuff, least mean squares blah blah) 

  %say what we do and why (spectral estimation is ok because  parameters don't change very fast)


%describe the problem setup: channel, eavesdropper


%summary of math - MUSIC (cite MATLAB) and how to estimate the coefficients (cite paper where we got that technique)


\section{Spatial Long-Range Channel Prediction Simulated Results}\label{simresults}
%belongs to Eric
%where is a good place for this sentence.
The channel model is shown in Figure (insert). Point A is the transmitter, several scatterers S, and a desired estimation location B. E is an array of sample readings taken in line with the listener. The model uses 10 scatterers, as it has been shown in (DUAL HALLEN citation) most real world channels contain less than 10 large scatterers. In our simulation we assume the sender A and all the scatterers reside in the far field. 
%in this section we apply the method from the previous section to a simulated channel

%describe the channel simulation (very similar to problem setup from previous section) - what did we assume about the problem geometry - how are the angles distributed? (uniformly) what is f_doppler/f_c?

%find average prediction length and how it varies for different values of $d$ (element spacing in E), $N$ (number of elements in E), and $S$ (number of scatterers) - include figures

These prediction lengths are unrealistic because the simulated channel doesn't change vs. position at all.  A realistic channel will change as the eavesdropper's position changes. 

\section{Conclusion}
%belongs to Clara
%we applied long-range prediction to estimate the channel transfer function at a location in space that is separated from the eavesdropper by more than a correlation length.  This indicates that the minimum safe distance for secure key generation based on wireless fading must be reexamined.

%future work: do a scenario where the eavesdropper moves through space and see if we can do spatiotemporal channel prediction simultaneously, see about 2D eavesdropper arrays and other problem geometries (what if all the scatterers are in an arc of the space instead of evenly distributed? does it matter?), do a security analysis by estimating the error of the prediction(?), demonstrate spatial channel prediction experimentally, investigate the effect of mutual coupling between array elements on the quality of the eavesdropper's predictions
\bibliography{PL-Library}{}
\end{document}